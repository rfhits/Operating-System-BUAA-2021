# OS个人思考

> 每当我觉得自己学懂了
> 习题、练习和思考都在告诉我
> “不，你没有”

author: rfhits

## bzero bcopy

真正滴涉及到底层的两个函数。清空一个页、写一个页，都要用到ta li

## pmap

### 二级页表

首先，c语言可以操作任何空间的地址，这个就是虚拟地址。

我们要做的就是模拟二级页表机制，往虚拟地址里面填写物理地址，再通过$f(va)->pa$和$f(pa)->va$转换取到地址里面的东西。

简单来说，把放着很多很多页的虚拟地址，按照虚拟地址的索引，把它对应的物理地址放到另一个虚拟地址pgidr里。

这样就“假装”建立起了二级页表，物理地址从未使用过，要访问时永远要加上ULIM。

`Page`结构体其实是物理地址的一个“象征”。因为它减去pages拿到ppn以后，shift12位再加上ULIM，就是虚拟地址，减去ULM又变回物理地址。建立起来虚拟页和物理页之间的桥梁。尽管自己不是真正的4KB页，但是是桥梁。

### page_alloc(struct Page \*\*pp)

给一个Page结构体的指针，从`free_page_list`里面分一个，然后用bzero把其对应的物理页里头内容清零。

### page_insert(vars)

我也不知道为什么要起这么个名字。给个\*pp和va，试图用pgdir建立二者之间的联系。

这个函数的简介就是说`mapping`了。

## env

### load_icode_mapper

### Trapfram


| Reg | Num |
| - | - |
| k0 | 26 |
| k1 | 27 |
| gp | 28 |
| sp | 29 |
| fp | 30 |
| ra | 31 |


| Reg | Num |
| - | - |
| vaddr | 8 |
| status | 12 |
| cause | 13 |
| epc | 14 |
