<!-- START doctoc generated TOC please keep comment here to allow auto update -->

<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [0x00 概述](#0x00-%E6%A6%82%E8%BF%B0)
- [0x01 磁盘工作原理](#0x01-%E7%A3%81%E7%9B%98%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86)
  - [1.磁盘结构](#1%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84)
  - [2.磁盘缺陷](#2%E7%A3%81%E7%9B%98%E7%BC%BA%E9%99%B7)
  - [3.磁盘的组织](#3%E7%A3%81%E7%9B%98%E7%9A%84%E7%BB%84%E7%BB%87)
    - [1）主引导扇区(MBR)](#1%E4%B8%BB%E5%BC%95%E5%AF%BC%E6%89%87%E5%8C%BAmbr)
    - [2）硬盘分区表(DPT)](#2%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA%E8%A1%A8dpt)
    - [3）分区引导扇区(DBR)](#3%E5%88%86%E5%8C%BA%E5%BC%95%E5%AF%BC%E6%89%87%E5%8C%BAdbr)
    - [4）磁盘地址与块号的转换](#4%E7%A3%81%E7%9B%98%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%9D%97%E5%8F%B7%E7%9A%84%E8%BD%AC%E6%8D%A2)
  - [4.磁盘访问时间](#4%E7%A3%81%E7%9B%98%E8%AE%BF%E9%97%AE%E6%97%B6%E9%97%B4)
- [0x02 磁盘调度（重点）](#0x02-%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E9%87%8D%E7%82%B9)
  - [1.磁盘调度算法](#1%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95)
    - [1）先来先服务算法（FCFS）](#1%E5%85%88%E6%9D%A5%E5%85%88%E6%9C%8D%E5%8A%A1%E7%AE%97%E6%B3%95fcfs)
    - [2）最短寻道时间优先算法（SSTF，Shortest Seek Time First）](#2%E6%9C%80%E7%9F%AD%E5%AF%BB%E9%81%93%E6%97%B6%E9%97%B4%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95sstfshortest-seek-time-first)
    - [3）扫描算法（SCAN）](#3%E6%89%AB%E6%8F%8F%E7%AE%97%E6%B3%95scan)
    - [4）循环扫描算法（CSCAN）](#4%E5%BE%AA%E7%8E%AF%E6%89%AB%E6%8F%8F%E7%AE%97%E6%B3%95cscan)
    - [5）LOOK 和 C-LOOK](#5look-%E5%92%8C-c-look)
  - [2.算法比较](#2%E7%AE%97%E6%B3%95%E6%AF%94%E8%BE%83)
- [0x03 磁盘空间管理](#0x03-%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86)
  - [1）位图法](#1%E4%BD%8D%E5%9B%BE%E6%B3%95)
  - [2）空闲表法](#2%E7%A9%BA%E9%97%B2%E8%A1%A8%E6%B3%95)
  - [3）空闲链表法](#3%E7%A9%BA%E9%97%B2%E9%93%BE%E8%A1%A8%E6%B3%95)
  - [4）成组链接法](#4%E6%88%90%E7%BB%84%E9%93%BE%E6%8E%A5%E6%B3%95)
- [0x04 廉价冗余磁盘阵列（RAID）](#0x04-%E5%BB%89%E4%BB%B7%E5%86%97%E4%BD%99%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97raid)
  - [RAID0：无差错控制的带区组](#raid0%E6%97%A0%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6%E7%9A%84%E5%B8%A6%E5%8C%BA%E7%BB%84)
  - [RAID1：镜像结构](#raid1%E9%95%9C%E5%83%8F%E7%BB%93%E6%9E%84)
  - [RAID2：带海明码校验](#raid2%E5%B8%A6%E6%B5%B7%E6%98%8E%E7%A0%81%E6%A0%A1%E9%AA%8C)
  - [RAID3：带奇偶校验的并行传送](#raid3%E5%B8%A6%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E7%9A%84%E5%B9%B6%E8%A1%8C%E4%BC%A0%E9%80%81)
  - [RAID4：带奇偶校验码的独立磁盘结构](#raid4%E5%B8%A6%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E7%A0%81%E7%9A%84%E7%8B%AC%E7%AB%8B%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84)
  - [RAID5：分布式奇偶校验的独立磁盘结构](#raid5%E5%88%86%E5%B8%83%E5%BC%8F%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E7%9A%84%E7%8B%AC%E7%AB%8B%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84)
  - [RAID6：带有两种分布存储的奇偶校验码的独立磁盘结构](#raid6%E5%B8%A6%E6%9C%89%E4%B8%A4%E7%A7%8D%E5%88%86%E5%B8%83%E5%AD%98%E5%82%A8%E7%9A%84%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E7%A0%81%E7%9A%84%E7%8B%AC%E7%AB%8B%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84)
  - [RAID level 比较](#raid-level-%E6%AF%94%E8%BE%83)
  - [RAID 小结](#raid-%E5%B0%8F%E7%BB%93)
- [0x05 提高磁盘I/O速度](#0x05-%E6%8F%90%E9%AB%98%E7%A3%81%E7%9B%98io%E9%80%9F%E5%BA%A6)
  - [1.磁盘高速缓存](#1%E7%A3%81%E7%9B%98%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98)
    - [1）磁盘高速缓存的形式](#1%E7%A3%81%E7%9B%98%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E7%9A%84%E5%BD%A2%E5%BC%8F)
    - [2）数据交付](#2%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BB%98)
    - [3）置换算法](#3%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95)
    - [4）周期性写回](#4%E5%91%A8%E6%9C%9F%E6%80%A7%E5%86%99%E5%9B%9E)
  - [2.提高磁盘I/O速度的其他方法](#2%E6%8F%90%E9%AB%98%E7%A3%81%E7%9B%98io%E9%80%9F%E5%BA%A6%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95)
    - [1）预读（Read-Ahead）](#1%E9%A2%84%E8%AF%BBread-ahead)
    - [2）延迟写](#2%E5%BB%B6%E8%BF%9F%E5%86%99)
    - [3）虚拟盘（virtual disk）](#3%E8%99%9A%E6%8B%9F%E7%9B%98virtual-disk)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

> 本文装载自Jay1Zhang的博客
>
> Author: Jay
>
> Link: [Jay1Zhang的博客](http://jay1zhang.github.io/2020/12/31/BUAA/Operating%20System/%E3%80%8C%E7%B3%BB%E7%BB%9F%E3%80%8D04-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/)
>
> Copyright Notice: All articles in this blog are licensed under [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) unless stating additionally.

## 0x00 概述

磁盘存储器不仅容量大，存取速度快，且可以实现随机存取，是实现虚拟存储系统所必需的硬件。

磁盘存储管理的主要任务是：

- 为文件分配必要的存储空间
- 提高磁盘存储空间的利用率
- 提高对磁盘的I/O速度，以改善文件系统的性能
- 采取必要的冗余措施，确保文件系统的可靠性

## 0x01 磁盘工作原理

### 1.磁盘结构

- 在磁盘设备中，可包含一个或多个**盘片**，每片**分两面**。
- 每个面上都有一个**磁头**，且每面又可分成若干条**磁道**。
- 在每条磁道上可存储相同数目的二进制位，每英寸中所存储的位数称为**磁盘密度**。

  - 显然，内层磁道的密度较外层磁道的密度高
- 每条磁道又分成若干个**扇区**，每个扇区的大小相当于一个盘块

  - 0扇区是最外层煮面的第一个磁道的第一个扇区
- 磁盘的顺序首先是磁道不同的扇区，然后是同一柱面的不同磁道，最后是由外向内的不同**柱面**。

  - 即磁盘大小：柱面数 x 一个柱面上的磁道数（盘片\*2） x 每条磁道上的扇区数 x 每个扇区的大小

[![image-20200925154109389](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925154109389.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925154109389.png)

补充：

- 对于磁盘，**每个磁道的扇区数并不是常量。**
- 绝大多数磁盘都有一些缺陷扇区，因此映射必须用磁盘上的其他空闲扇区来替代这些**缺陷扇区**。

### 2.磁盘缺陷

硬盘的实际扇区数比硬盘标签上标定的大，其中

- **一部分用于存储硬盘的固件**。
- 一部分是用户存储数据的区域，即**工作区**，也就是**硬盘标定容量的扇区**。
- 剩下的为**保留区**。

[![image-20200925154456497](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925154456497.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925154456497.png)

几个概念：

- P表，又称永久缺陷列表
  - 用于记录硬盘**生产过程中**产生的缺陷。
  - 读到该扇区将直接**跳过**。
- G表：又称为增长缺陷列表
  - 用于记录硬盘**使用过程中**由于磁介质性能变弱而引起的缺陷
  - 读到坏扇区将**转读原保留区**。

### 3.磁盘的组织

#### 1）主引导扇区(MBR)

硬盘的**0柱面，0磁头，1扇区**成为主引导扇区（也称主引导记录MBR），该记录占用**512**个字节，**用于硬盘启动时将系统控制权转给**用户指定的、在分区表中登记了**某个操作系统分区**。

MBR包含三部分内容

- 0~446字节为启动代码及数据；
- 447-510字节（64个字节）则是**分区表（DPT）**
  - 分区表由四个分区项组成，每个分区项16字节，记录了启动时需要的分区参数。
- 最后两个字节AA和55被成为**幻数（Magic Number）**
  - BIOS读取MBR时会检查是否有这两个幻术，若无则认为该硬盘未分区。

[![image-20200925155308370](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925155308370.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925155308370.png)

硬盘分区有三种：**主磁盘分区、扩展磁盘分区、逻辑分区**。

由于MBR的限制，最多只能有4个分区。

- 一个硬盘**主分区**至少有1个，最多4个；
  - 主分区**只能有一个是激活的**（active），其余为inactive，且**操作系统必须装载主分区上面**。
- 分出主分区后，其余的部分可以分成**扩展分区**，扩展分区可以没有，但最多1个；
  - 扩展分区不能直接使用，必须分成若干逻辑分区。
- 主分区+扩展分区总共不能超过4个，所有的逻辑分区都是扩展分区的一部分。

#### 2）硬盘分区表(DPT)

从偏移01BEH开始到偏移01FDH结束的64字节，包含四个分区，每个分区16字节，其内容与含义如下 ：

- 第0个字节是自举标志，其值为80H时表示该分区是当前**活动分区**
- 第4个字节是**分区类型**

[![image-20200925160303055](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925160303055.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925160303055.png)

#### 3）分区引导扇区(DBR)

- DBR是由硬盘的MBR装载的程序段。
- DBR装入内存后，即开始执行该引导程序段，其主要功能是**完成操作系统的自举并将控制权交给操作系统**。
- 每个分区都有引导扇区，但只有被设为**活动分区**的DBR才会被MBR装入内存运行。

#### 4）磁盘地址与块号的转换

- **磁盘地址**（CHS）：Cylinder, Head, Sector
- **块号**：又称逻辑块号（LBA）, Logic Block Address，**逻辑块是最小的传输单位\*\***。

[![image-20200925161029468](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925161029468.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925161029468.png)

### 4.磁盘访问时间

磁盘的访问时间，包括以下三部分。

- **寻道时间 Ts**
  - 把磁头从当前位置**移动到指定磁道**上所经历的时间，\*_Ts = m \* n + s\*_
  - 即，启动磁盘的时间s与磁头移动n条磁道所花费的时间之和
  - 其中m是一常量，与磁盘驱动器的速度有关。
    - 对于一般磁盘，m = 0.3
    - 对于高速磁盘，m <= 0.1
- **旋转延迟时间 Tr**
  - 把磁头从当前磁道**移动到指定扇区**下所经历的时间，**Tr = 1/(2r)**
  - 对于硬盘，典型的旋转速度为 3600r/min，每转需16.7ms，平均旋转延迟时间Tr为8.3ms。
  - 对于软盘，旋转速度为300或600r/min，平均旋转延迟时间Tr为50~100ms。
- **传输时间 Tt**
  - Tt是指**把数据从磁盘读出**，或**向磁盘写入数据**所经历的时间，**Tt = b / (rN)**
  - Tt的大小与每次所读/写的字节数b，旋转速度r以及磁道上的字节数N有关
  - 典型的N值为一个扇区：512Byte，旋转速度为3600RPM ~ 15000RPM，故硬盘1s可传输的数据为2MB ~ 50MB

**访问时间**

- 寻道时间 + 旋转延迟时间 + 传输时间，即 Ta = Ts + 1/(2r) + b/(rN) 。

## 0x02 磁盘调度（重点）

### 1.磁盘调度算法

#### 1）先来先服务算法（FCFS）

按访问请求**到达的先后次序**服务。

#### 2）最短寻道时间优先算法（SSTF，Shortest Seek Time First）

优先选择**距当前磁头最近的访问请求**进行服务。

#### 3）扫描算法（SCAN）

当有访问请求时，磁头**按一个方向移动**，在移动过程中对遇到的访问请求进行服务，然后判断该方向上是否还有访问请求，如果有则继续扫描；否则改变移动方向，并为经过的访问请求服务。

- 克服了最短寻道优先的缺点，既考虑了距离，同时又考虑了方向
- 由于SCAN算法偏向于处理那些接近最里或最外的磁道的访问请求，所以使用改进型的C-SCAN算法可避免这个问题。

#### 4）循环扫描算法（CSCAN）

当磁头到达最后一个柱面后，快速返回0号柱面；返回时不为任何的等待访问者服务，返回后再次进行扫描。

#### 5）LOOK 和 C-LOOK

SCAN与C-SCAN磁头总是严格地遵循从盘面的一端到另一端，显然，**磁头移动只需要到达最远端的一个请求即可返回，不需要到达磁盘端点**。这种形式的SCAN与C-SCAN算法称为LOOK 和 C-LOOK调度。

### 2.算法比较

[![image-20200925162934919](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925162934919.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925162934919.png)

## 0x03 磁盘空间管理

#### 1）位图法

用一串二进制位反应磁盘空间中分配使用情况，每个物理块对应一位，分配的物理块为0，否则为1。

[![image-20200925163333477](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163333477.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163333477.png)

#### 2）空闲表法

将所有空闲块记录在一个表中，即空闲表；

- 主要记录两项内容：起始块号，块数

[![image-20200925163341670](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163341670.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163341670.png)

#### 3）空闲链表法

把所有空闲块链成一个表，但链会很长。

#### 4）成组链接法

把空白物理块分成组，在通过指针把组与组之间链接起来。

成组链接法的**优点**：

1. 空白块号登记不占用额外空间；
2. 节省时间；
3. 采用后进先出的栈结构思想

[![image-20200925163618359](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163618359.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925163618359.png)

## 0x04 廉价冗余磁盘阵列（RAID）

> 考虑**可靠性**，具有N个磁盘的磁盘组中某些磁盘比特定磁盘具有较高的出错率。假设单个磁盘的平均损坏时间为100000小时，具有100个磁盘的阵列中某些磁盘的平均损坏时间为100000/100小时，大约是41.66天。这样高的数据丢失率是不能接受的。
>
> 解决可靠性问题的方法是引入冗余技术存储一般不需要的额外的信息，可以在磁盘损坏时用来恢复丢失的信息。

廉价冗余磁盘阵列（Redundant Arrays of Inexpensive Disks, RAID）

- 其基本思想就是把多个相对便宜的硬盘组合起来，成为一个硬盘阵列组，使性能达到甚至超过一个价格昂贵、容量巨大的硬盘。
- 根据选择的版本不同，RAID比单颗硬盘有以下一个或多个方面的好处：
  - 增强数据集成度，增强容错功能，增加处理量或容量。
  - 另外，磁盘阵列对于电脑来说，看起来就像一个单独的硬盘或逻辑存储单元

磁盘阵列中针对不同的应用使用不同的技术，称为 RAID level。每一 level 代表一种技术，不同 level 并不代表技术的高低。

### RAID0：无差错控制的带区组

**条带化（Stripe）存储**，RAID0需要两个以上的磁盘来组成带区组，数据分为**数据块**保存在**不同的驱动器**上。

[![image-20200925165350553](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925165350553.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925165350553.png)

由于数据分布在不同驱动器上，所以**数据吞吐率大大提高**，驱动器的负载也比较平衡。

- 理论上说，有N个磁盘组成的RAID0是单个磁盘读写速度的N倍。

RAID0不计算校验码，因而没有冗余校验功能，也没有数据差错控制，因此它并不能算是真正的RAID结构。

### RAID1：镜像结构

它是**镜象（Mirror）磁盘冗余阵列**，将每一数据块**重复存入镜像磁盘**，以改善磁盘机的可靠性。

- 镜像盘也称为拷贝盘，相当于一个不断进行备份操作的磁盘。

[![image-20200925165747113](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925165747113.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925165747113.png)

- 优势：

  - 当原始数据繁忙时，可直接从镜像拷贝中读取数据，因此RAID 1可以**提高读取性能**。
  - 当一个磁盘失效时，系统可以自动切换到镜像磁盘上读写，而不需要重组失效的数据，提供了**很高的数据安全性和可用性**。
- 缺点：

  - RAID 1的硬盘容量利用率只有50%，是所有RAID级别中最低的，因而**单位成本也最高**。

### RAID2：带海明码校验

RAID 2是采用**海明码**（Hamming Code）纠错冗余的磁盘阵列，将数据位交叉写入几个磁盘中，并利用几个磁盘驱动器进行按位的出错检查，冗余度比RAID1小。

[![image-20200925170525302](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925170525302.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925170525302.png)

- 特点：
  - **并行存取**，各个驱动器同步工作。
  - 使用海明编码来进行错误检测和纠正，**数据传输率高**。
  - **需要多个磁盘来存放海明校验码信息**，冗余磁盘数量与数据磁盘数量的对数成正比。
  - 这种阵列的数据读写操作涉及阵列中的每一个磁盘，影响小文件的传输率，因此它**适合大量顺序数据访问**。
  - 是一种在多磁盘易出错环境中的有效选择，并**未被广泛应用**，目前还没有商业化产品

### RAID3：带奇偶校验的并行传送

RAID 3采用奇偶校验冗余的磁盘阵列，阵列中只有一个**共享校验盘**，将数据按位交叉写到几个磁盘上，用一个校验盘检查数据错误，数据条带**存储单位为字节**。

- 基本思想：
  - 将磁盘分组，读写要访问组中所有盘，每组中有一个盘作为校验盘。
  - 简单理解：先将分布在各个数据盘上的一组数据加起来，将和存放在冗余盘上。一旦某一个盘出错，只要将冗余盘上的和减去所有正确盘上的数据，得到的差就是出错的盘上的数据。

[![image-20200925171256055](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925171256055.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925171256055.png)

- 特点
  - 它同RAID 2非常类似，都是将数据条块化分布于不同的硬盘上，**区别在于RAID 3使用简单的奇偶校验**，并**用单块磁盘存放奇偶校验信息**。
  - RAID 3对于**大量的连续数据**可提供很好的传输率，但对于随机数据来说，奇偶盘会成为写操作的瓶颈。

### RAID4：带奇偶校验码的独立磁盘结构

RAID 4也是用一个校验盘，但和RAID 3不一样。RAID 4是**以扇区作为数据分段**，各磁盘相同位置的分段形成一个校验磁盘分段，放在校验盘。

- 特点：
  - **冗余代价与RAID3相同**
  - **访问数据的方法与RAID3不同**
  - 在RAID3中，一次磁盘访问将对磁盘阵列中的**所有**磁盘进行操作。
  - RAID4出现的原因：希望使用**较少**的磁盘参与操作，以使磁盘阵列可以并行进行多个数据的磁盘操作

### RAID5：分布式奇偶校验的独立磁盘结构

RAID 5 避免了 RAID 4 的瓶颈，校验数据分布式存储，数据条带**存储单位为块**。

RAID 5不单独指定的奇偶盘，而是在所有磁盘上交叉地存取数据及奇偶校验信息。在RAID 5上，读/写指针可同时对阵列设备进行操作，提供了更高的数据流量。

[![image-20200925172249451](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172249451.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172249451.png)

- 特点
  - RAID 5更**适合于小数据块和随机读写的数据**。
  - RAID 3与RAID 5相比，最主要的区别在于RAID 3每进行一次数据传输就需涉及到**所有**的阵列盘；而对于RAID 5来说，大部分数据传输只对**一块磁盘**操作，并可进行**并行**操作。
  - 在RAID 5中有“写损失”，即每一次写操作将产生四个实际的读/写操作，其中两次读旧的数据及奇偶信息，两次写新的数据及奇偶信息。
  - 当进行恢复时，如我们需要恢复图中的A0，这里就必须需要B0、C0、D0加0 parity才能计算并得出A0，进行数据恢复。所以当有两块盘坏掉的时候，整个RAID的数据失效。

### RAID6：带有两种分布存储的奇偶校验码的独立磁盘结构

两个分布式存储的校验数据，数据条带存储单位为块。

与RAID 5相比，RAID 6增加了第二个独立的奇偶校验信息块。两个独立的奇偶系统**使用不同的算法**，数据的**可靠性非常**高，即使两块磁盘同时失效也不会影响数据的使用。

[![image-20200925172451397](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172451397.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172451397.png)

- 特点
  - RAID 6需要分配给奇偶校验信息更大的磁盘空间
  - 写入数据要访问1个数据盘和2个冗余盘，相对于RAID 5有更大的“写损失”，因此“写性能”非常差；
  - 可容忍双盘出错；
  - 存储开销是RAID5的两倍（多一个冗余盘）。
  - 较差的性能和复杂的实施方式使得RAID 6很少得到实际应用

### RAID level 比较

[![image-20200925172551030](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172551030.png)](http://jayyy1.gitee.io/images/posts/BUAA/image-20200925172551030.png)

### RAID 小结

- 条带化：一个字节块可能存放在多个数据盘上

  - 优点：并行存取，性能好，磁盘负载均衡
  - 缺点：可靠性、不同IO请求需要排队
- 镜像：数据完全拷贝一份

  - 优点：可靠性
  - 缺点：存储开销
- 校验：数据通过某种运算（异或）得出，用以检验该组数字的正确性

  - 优点：可靠性，快速恢复
  - 缺点：开销

## 0x05 提高磁盘I/O速度

提高I/O速度的主要途径

- 选择性能好的磁盘
- 并行化
- 采用适当的调度算法
- 设置磁盘**高速缓冲区**

### 1.磁盘高速缓存

这里所说的高速缓存，**并非**通常意义下载内存和CPU之间所增设的一个小容量高速存储器，而是指**利用内存中的存储空间，暂存从磁盘中读出的一系列盘块中的信息**。

- 即这里的高速缓存是**一组在逻辑上属于磁盘，而在物理上是驻留在内存中的盘块**。

#### 1）磁盘高速缓存的形式

高速缓存在内存中可分为两种形式：

- **独立缓存**：在内存中开辟一个单独的存储空间作为磁盘高速缓存，其**大小固定**。
- **虚拟内存为缓存**：把所有未利用的内存空间变为一个缓冲池，供请求分页系统和磁盘I/O共享，**大小不固定**。

#### 2）数据交付

数据交付（data delivery）是指将磁盘高速缓冲中的数据传送给**请求者进程**。

主要有以下两种形式：

- **直接交付**：直接将高速缓存中的数据**copy**到请求者进程的内存工作区中。
- **指针交付**：只将指向高速缓存中某区域的**指针**，交付给请求者进程。

#### 3）置换算法

LRU

#### 4）周期性写回

周期性地将disk cache中被修改过的内容写回磁盘。

### 2.提高磁盘I/O速度的其他方法

#### 1）预读（Read-Ahead）

顺序访问时，常采用**提前读**入下一块到缓冲区中。

#### 2）延迟写

将本应立即写回磁盘的数据挂到空闲缓冲区的队列的末尾，直到该数据块移到链头时才将其写回磁盘，再作为空闲区分配出去（可靠性？）

#### 3）虚拟盘（virtual disk）

利用**内存空间去**仿真磁盘（RAM盘）

- Vitual disk 与disk cache的区别是：
  - Vitual disk的存放的内容由用户完全控制
  - Disk cache中的内容完全是由操作系统控制
