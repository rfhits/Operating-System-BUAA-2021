<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [lab1ä¸Šæœº](#lab1%E4%B8%8A%E6%9C%BA)
  - [lab1-1](#lab1-1)
    - [exam](#exam)
    - [Extra](#extra)
      - [é¢˜ç›®](#%E9%A2%98%E7%9B%AE)
      - [è§£å†³](#%E8%A7%A3%E5%86%B3)
    - [æ€»ç»“](#%E6%80%BB%E7%BB%93)
  - [lab1-2](#lab1-2)
    - [å»ºè®®](#%E5%BB%BA%E8%AE%AE)
    - [exam](#exam-1)
      - [é¢˜ç›®](#%E9%A2%98%E7%9B%AE-1)
      - [è§£ç­”](#%E8%A7%A3%E7%AD%94)
      - [æµ‹è¯•](#%E6%B5%8B%E8%AF%95)
    - [Extra](#extra-1)
  - [æ€»ç»“](#%E6%80%BB%E7%BB%93-1)
    - [structçš„å®šä¹‰å’Œåˆå§‹åŒ–](#struct%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96)
    - [structè·å–æˆå‘˜å˜é‡](#struct%E8%8E%B7%E5%8F%96%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F)
    - [byebye](#byebye)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# lab1ä¸Šæœº

## lab1-1

åˆ†æˆexamå’ŒExtraï¼Œä¸»è¦è€ƒå¯Ÿçš„è¿˜æ˜¯elfæ–‡ä»¶æ ¼å¼ã€‚

ç²—ç•¥ç”»äº†ä¸‹elfæ–‡ä»¶çš„ç¤ºæ„å›¾ï¼Œå…¶ä¸­{}è¡¨ç¤ºç»“æ„ä½“ï¼Œ[]è¡¨ç¤ºæ•°ç»„

```
|--------------------
|elf_header{
|       section_header_table_offset
|       program_header_table_offset
|       ...
|}
|--------------------
|       ...
|--------------------
|       section header table:
|               an array of section header{}
|       section header-1 {
|               section addr
|               ...
|       }
|
|       section header-2 {
|               section addr
|       }
|
|       ...
|--------------------
```

### exam

lab1è¯¾ä¸‹ï¼Œåªéœ€å°†section addrè¾“å‡ºï¼Œè¯¾ä¸Šï¼Œè¦å°†program headeré‡Œçš„offsetå’Œalignè¾“å‡ºã€‚

### Extra

#### é¢˜ç›®

æˆ‘ä»¬çŸ¥é“ï¼Œæ•°æ®çš„å­˜å‚¨åˆ†ä¸ºå¤§å°ç«¯ï¼Œå¹¶ä¸”elf headerä¸­çš„e_ident[5]æŒ‡æ˜äº†æ–‡ä»¶ä¸­çš„æ•°æ®ç¼–ç æ ¼å¼ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ELFæ‰‹å†Œä¸­æ‰¾åˆ°ç›¸å…³çš„ä¿¡æ¯ã€‚

ç°åœ¨ï¼Œè¦ä½ ä¿®æ”¹readelf.cæ–‡ä»¶ï¼Œ

å½“å…¶è§£æå¤§ç«¯å­˜å‚¨çš„elfæ ¼å¼æ–‡ä»¶æ—¶ï¼Œè¾“å‡ºæ¯ä¸ªsectionçš„addr

å½“å…¶è§£æå°ç«¯å­˜å‚¨çš„æ–‡ä»¶æ—¶ï¼Œè¾“å‡ºæ¯ä¸ªprogramçš„fileszå’Œmemsz

gexmulæ–‡ä»¶å¤¹å†…çš„vmlinuxæ–‡ä»¶ä»¥å¤§ç«¯å­˜å‚¨ï¼Œreadelfæ–‡ä»¶å¤¹å†…testELFæ–‡ä»¶ä»¥å°ç«¯å­˜å‚¨ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºæµ‹è¯•ä½ æ”¹å†™çš„readelfæ–‡ä»¶çš„æ­£ç¡®æ€§ã€‚

#### è§£å†³

éš¾ç‚¹æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯å¤§ç«¯å­˜å‚¨æ€ä¹ˆè½¬æ¢ä¸ºå°ç«¯å­˜å‚¨ï¼ŒäºŒæ˜¯è¦æŠŠå“ªäº›æ•°æ®ä»å¤§ç«¯è½¬æ¢æˆå°ç«¯ã€‚

å…ˆç®€å•è®²ä¸‹å¤§å°ç«¯ï¼Œå¤§ç«¯`0x12_34_56_78`ï¼Œå¯¹åº”å°ç«¯å°±æ˜¯`0x78_56_34_12`ï¼Œå°†å››ä¸ªå­—èŠ‚reverseå³å¯ã€‚

è¿™ä¸€éƒ¨åˆ†å¯ä»¥çœ‹å¾€å±Šå­¦é•¿çš„å®ç°

å¯¹äºéš¾ç‚¹ä¸€ï¼š

```
#define REVERSE_32(n_n) \
	((((n_n)&0xff) << 24) | (((n_n)&0xff00) << 8) | (((n_n) >> 8) & 0xff00) | (((n_n) >> 24) & 0xff))

#define REVERSE_16(n_n) \
	((((n_n)&0xff) << 8) | (((n_n) >> 8) & 0xff))
```

å°±æ˜¯æ‹¿åˆ°ä¸€ä¸ª32ä½çš„integerï¼Œé€šè¿‡ä½è¿ç®—ï¼Œå–å¾—æƒ³è¦çš„å­—èŠ‚ï¼Œå†å·¦å³ç§»åŠ¨ï¼Œä½¿å¾—é¡ºåºæ”¹å˜å³å¯ã€‚

æˆ–æ˜¯å¦‚æ­¤:

```
uint32_t rvs_32(uint32_t* ptr) {
        u_char char1, char2, char3, char4;
        char1 = *((u_char*) ptr);
        char2 = *((u_char*) ptr + 1);
        char3 = *((u_char*) ptr + 2);
        char4 = *((u_char*) ptr + 3);
        return ((uint32_t) char1 << 24) + ((uint32_t) char2 << 16) + ((uint32_t) char3 << 8) + ((uint32_t) char4);
}

uint16_t rvs_16(uint16_t* ptr) {
        u_char char1, char2;
        char1 = *((u_char*) ptr);
        char2 = *((u_char*) ptr + 1);
        // char3 = *((U_char*) ptr + 2);
        // cahr4 = *((u_char*) ptr + 3);
        return ((uint16_t) char1 << 8) + ((uint16_t) char2);
}
```

å…ˆç»™ä¸ªæŒ‡å‘32bitçš„æŒ‡é’ˆï¼ŒæŠŠæŒ‡é’ˆç»™å¼ºè½¬æˆæŒ‡å‘8bitï¼Œç„¶åæŠŠè¿™8bitä¸€ä¸ªä¸€ä¸ªé€šè¿‡*è¿ç®—ç¬¦æ‹¿å‡ºæ¥ï¼Œæœ€åæŠŠ8bitå¼ºè½¬ä½32bitï¼Œæ‹¼æ¥å¥½å°±è¡Œã€‚

ç¬¬äºŒä¸ªéš¾ç‚¹â€”â€”å“ªäº›æ•°æ®éœ€è¦åè½¬

æˆ–è®¸æœ‰äººè¯´ï¼Œè¾“å‡ºåœ°å€ï¼Œé‚£ç›´æ¥æŠŠåœ°å€åè½¬å°±å¥½äº†ï¼Œå…¶å®ä¸ç„¶ã€‚

é¦–å…ˆè¦é€šè¿‡`offset`æ‹¿åˆ°`program header table`çš„åœ°å€æ—¶ï¼Œ`offset`éœ€è¦ç¿»è½¬ã€‚

éå†æ¯ä¸ª`segement`æ—¶,éœ€è¦`count`å’Œ`size`ï¼Œè¿™ä¸ªä¹Ÿéœ€è¦ç¿»è½¬ã€‚

æ‰€ä»¥ï¼Œå¯¹äºæœ¬æ¬¡`Extra`ï¼Œæœ‰å››å¤„éœ€è¦ç¿»è½¬ã€‚

### æ€»ç»“

Extraåªæ‹¿äº†50åˆ†,å› ä¸ºdebugå¤±è´¥ï¼Œä¸ºäº†å¾—ç‚¹åˆ†ï¼ŒExtraåªåšäº†å°ç«¯çš„é¢˜ã€‚ç„¶åå°±æ˜¯å›æ¥å¤ç›˜

1. å¦‚æœä»¥æŸç§æ–¹å¼äº†è§£åˆ°äº†è¯¾ä¸Šçš„é¢˜ç›®ï¼Œæ¯”å¦‚lab1-1-Extraè€ƒå¯Ÿendianï¼Œé‚£ä¹ˆå¯ä»¥å…ˆè‡ªå·±å®ç°åˆ°æœåŠ¡å™¨é‡Œ
2. å¦‚æœæƒ³å¤ç›˜çš„è¯ï¼Œä¸è¦æŠŠæ— å…³ä»£ç åˆ æ‰ï¼Œå°½é‡æ³¨é‡Šæ‰ï¼Œæ–¹ä¾¿è¯¾ä¸‹çœ‹çœ‹è‡ªå·±å½“æ—¶å†™å¾—å’‹æ ·

æœ€åæ˜¯æˆ‘çš„bugï¼š

`undefined reference to "function_name"`ï¼Œæ®æˆ‘çš„çŒœæµ‹ï¼Œåº”è¯¥æ˜¯å‘½åå‡½æ•°æ—¶ï¼Œä½¿ç”¨äº†rvsè¡¨ç¤ºreverseï¼Œåœ¨è°ƒç”¨æ—¶ï¼Œæ‰“æˆäº†rsvï¼Œæ‰€ä»¥æ²¡æ³•ç¼–è¯‘æˆåŠŸã€‚

ä¸ç¦è¦æŠ±æ€¨ä¸‹å­¦æ ¡æœåŠ¡å™¨ï¼Œgccç‰ˆæœ¬éå¸¸è€ï¼Œå¦‚æœæœ‰errorï¼Œä¼šå‘Šè¯‰å¤§å®¶çŠ¯äº†å•¥é”™ï¼Œè€Œä¸ä¼šç»™å‡ºå¯èƒ½çŠ¯é”™çš„åŸå› ã€‚å¦‚æœæˆ‘çš„ä»£ç åœ¨è‡ªå·±çš„æœºå­ä¸Šè·‘ï¼Œgccä¼šæç¤ºæˆ‘æ˜¯å¦å°†rsvæˆ–rvsä¸¤ä¸ªå‡½æ•°åæ‰“é”™äº†ï¼Œ~éå¸¸è´´å¿ƒ~ã€‚

## lab1-2

è¿™æ¬¡ä¸Šæœºï¼ŒçœŸæ˜¯è§è¯äº†äººä¸äººä¹‹é—´çš„å‚å•†â€”â€”æœ‰çš„äººExtraæ‹¿æ»¡åˆ†ï¼Œæœ‰çš„äººexamæ‹¿0åˆ†ã€‚

è¿™æ¬¡ä¸Šæœºï¼Œè€ƒå¯Ÿäº†å¾ˆå¤šcè¯­è¨€çš„åŸºç¡€çŸ¥è¯†ï¼Œå¯¹é«˜å·¥çš„åŒå­¦æä¸ºä¸åˆ©ï¼Œå‡ ä¹å›¢ç­ã€‚

ä¿—è¯è¯´ï¼Œå‰äººæ ½æ ‘ï¼Œåäººä¹˜å‡‰ï¼Œç°åœ¨çœ‹æ¥ï¼Œå¹¶éå¦‚æ­¤ã€‚ç»å†äº†è¿™æ¬¡ä¸Šæœºï¼Œæ„Ÿè§‰OSæœ‰å¹´å¹´å˜éš¾çš„è¶‹åŠ¿ã€‚

æˆ‘ä¹Ÿåªåšäº†examï¼Œï¼Œå¯¹æœ¬èœé¸Ÿæ¥è¯´ï¼ŒçœŸæ˜¯å¤ªéš¾äº†ã€‚

### å»ºè®®

æ—©ç‚¹åˆ°æ•™å®¤ï¼Œå¼€æœºè¦æ¯”è¾ƒä¹…çš„æ—¶é—´ï¼ˆåæ§½åƒåœ¾ç”µè„‘ï¼‰ï¼Œè¿chromeæ‰“å¼€éƒ½è¦å°†è¿‘ä¸€åˆ†é’Ÿã€‚ä¸ç¦æ„Ÿæ…¨ï¼Œè‹å¤©å•Šï¼Œæ‰å—é™¨çŸ³æŠŠæœºæˆ¿ç ¸äº†å§ï¼Œåˆ©å›½åˆ©æ°‘å•Šï¼

æˆ‘ä¸ªäººä¼šåœ¨æ¡Œé¢ä¸Šæ–°å»ºä¸€ä¸ªtxtï¼Œç”¨æ¥å­˜æ”¾ï¼š

1. å¸¸ç”¨çš„å‘½ä»¤ï¼Œå¦‚`gxemul -E testmips -C R3000 -M 64 vmlinux`å’Œ`git push ...`
2. è™šæ‹Ÿæœºä¸Šç¼–è¯‘æŠ¥çš„é”™ï¼Œä¸€æ˜¯æ–¹ä¾¿æŸ¥çœ‹å“ªé”™äº†ï¼ŒäºŒæ˜¯labæŒ‚äº†å¯ä»¥ç²˜è´´åˆ°è™šæ‹Ÿæœºçš„æ–‡ä»¶å¸¦å›è¯¾ä¸‹ç ”ç©¶

æˆ‘è¿˜ä¼šåŒæ—¶æ‰“å¼€`dev c++`ï¼Œå¥½å¤„æœ‰ä¸¤ä¸ªï¼š

1. æŠŠè‡ªå·±çš„ä¸€äº›ä»£ç ç²˜è´´è¿›å»ï¼Œæ–¹ä¾¿è‡ªå·±çœ‹
2. å†™ä¸€äº›è¶…çº§å°çš„ç¨‹åºï¼Œä¸€èˆ¬ä¸è¶…è¿‡20è¡Œï¼Œæµ‹è¯•ä¸‹è‡ªå·±çš„æ€è·¯

å¯¹äº†ï¼Œæœ‰çš„åŒå­¦ä¼šæŠŠ`gxemul -E testmips -C R3000 -M 64 ./gxemul/vmlinux`ã€`git add .`å’Œ`git commit -a -m "sth"`ç›´æ¥å†™è¿›makefileï¼Œéå¸¸niceã€‚

### exam

#### é¢˜ç›®

æˆ‘ä»¬å·²ç»è¡¥å…¨äº†printçš„ä»£ç ï¼Œç°åœ¨æœ‰ä¿©ç»“æ„ä½“ï¼š

```cpp
struct s1 {
	int a;
	char b;
	char c;
	int d;
};

struct s2 {
	int size;
	int c[c_size];
};
```

è¯´æ˜ï¼š

1. `struct s2`é‡Œï¼Œ`c_size`ä¿è¯å’Œ`size`ç›¸ç­‰
2. ç»™`printf`ä¼ å…¥çš„ç›¸å…³å‚æ•°æ˜¯`struct`çš„**åœ°å€**

`printf("%$1T", addr_of_s1)`ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªç»“æ„ä½“ä¸­çš„å†…å®¹ï¼Œæ ¼å¼å¦‚`{1,"a","b",2}`

`printf("%$2T", addr_of_s2)`ï¼Œè¾“å‡ºç¬¬äºŒä¸ªç»“æ„ä½“ä¸­çš„å†…å®¹ï¼Œæ ¼å¼å¦‚`{4,3,1,2,4}`ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsizeå’Œæ•°ç»„é‡Œé¢çš„å€¼è¦ä¸€èµ·è¾“å‡ºã€‚

å¥½äº†ï¼Œå¼€å§‹åšå§ğŸ˜„

#### è§£ç­”

åœ¨è‡ªå·±çš„print.cé‡Œé¢ï¼Œç”¨`typedef`å£°æ˜è¿™å‡ ä¸ªç»“æ„ä½“ã€‚

```cpp
typedef struct {
        int a;
        char b;
        char c;
        int d;
} s1;

typedef struct {
        int size;
        int c[10000];
} s2;
```

ä¸ºä»€ä¹ˆè¦ç”¨`typedef`ï¼ŒåŸå› å¾ˆç®€å•ï¼Œ`struct`çš„è¯­æ³•å¿˜å¾—å·®ä¸å¤šäº†ï¼Œè€Œ`readelf`æ–‡ä»¶å¤¹ä¸‹çš„`types.h`é‡Œé¢çš„ç»“æ„ä½“å°±æ˜¯è¿™ä¹ˆå£°æ˜çš„ï¼Œè¿™æ ·ä¸€æ¥é¿å…åé¢å®šä¹‰æŒ‡é’ˆçš„ä¸ä¾¿ï¼ŒäºŒæ¥æœ‰ä¸ªå‚è€ƒã€‚

ç„¶åå£°æ˜å‡ ä¸ªå’Œ`struct`ç›¸å…³çš„æŒ‡é’ˆå’Œå˜é‡ï¼Œå‰è€…ç”¨æ¥æ¥æ”¶åœ°å€ã€‚

```cpp
int type;
s1* a_s1;
s2* a_s2;
int var_for; // for å¾ªç¯é‡Œé¢çš„å‚æ•°
int size;
int* arr_int; // type in struct s2
```

é€šè¿‡`$`åˆ¤æ–­è¦è¾“å‡ºç»“æ„ä½“ç„¶åå†è·å–`type`çš„ä»£ç æˆ‘å°±ä¸å†™äº†ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚

æœ€æœ€é‡è¦çš„å°±æ˜¯é‚£ä¸ªcaseé‡Œï¼ŒçœŸå¯è°“åˆè‡­åˆé•¿ã€‚

é¦–å…ˆï¼Œç”¨æŒ‡é’ˆæ¥å—å‚æ•°ï¼Œé¡ºä¾¿è¾“å‡º`'{'`ï¼š

```cpp
case 'T':
        if (type == 1) {
                a_s1 = (s1*)va_arg(ap, s1*); // ä¿é™©èµ·è§ï¼Œåšäº†å¼ºåˆ¶è½¬æ¢
        } else {
                a_s2 = (s2*)va_arg(ap, s2*);
        }
        // output the '{'
        length = PrintChar(buf, '{', 1, 0);
        OUTPUT(arg, buf, length);
```

å¦‚æœ`type == 1`ï¼Œé€ä¸ªæ¥å—å‚æ•°ï¼š

```cpp
if (type == 1) {
        // output int a, char b, char c, int d;
                int a = a_s1->a;
                char b = a_s1->b;
                char c = a_s1->c;
                int d = a_s1->d;
```

ç„¶åé€ä¸ªè¾“å‡ºabcdï¼Œæ³¨æ„æ ¼å¼ï¼š

```cpp
// print int a;
negFlag = 0;
if (a < 0) {
        a = -a;
        negFlag = 1;
}
length = PrintNum(buf, a, 10, negFlag, width, ladjust, padc, 0);
OUTPUT(arg, buf, length);

// print ','
length = PrintChar(buf, ',', 1, 0);
OUTPUT(arg, buf, length);

// print char b
length = PrintChar(buf, b, width, ladjust);
OUTPUT(arg, buf, length);

// print ','
length = PrintChar(buf, ',', 1, 0);
OUTPUT(arg, buf, length);

// print char c
length = PrintChar(buf, c, width, ladjust);
OUTPUT(arg, buf, length);

// print ','
length = PrintChar(buf, ',', 1, 0);
OUTPUT(arg, buf, length);

// print int d
negFlag = 0;
if (d < 0) {
        d = -d;
        negFlag = 1;
}
length = PrintNum(buf, d, 10, negFlag, width, ladjust, padc, 0);
OUTPUT(arg, buf, length);
```

å¾ˆé—æ†¾æ²¡æœ‰æ’ç‰ˆï¼Œä¸è¿‡æ¨¡ä»¿æ•™ç¨‹ä¸­çš„è¯­æ°”ï¼Œ

> æƒ³å¿…**èªæ˜**çš„ä½ å·²ç»æ˜ç™½æˆ‘æƒ³è¯´ä»€ä¹ˆäº†å§~â¤ï¸

å¦‚æœ`type != 1`ï¼Œè¾“å‡ºsizeå’Œæ•°ç»„ï¼š

```cpp
else {
    size = a_s2->size; // æ‹¿åˆ°size
    arr_int = a_s2->c; // æ‹¿åˆ°æ•°ç»„
    for (var_for = 0; var_for < size; var_for++) { // var_for å·²ç»é¢„å…ˆå®šä¹‰å¥½äº†ï¼Œä¸º0
            int x = arr_int[var_for];
            negFlag = 0;
            if (x < 0) {
                    x = -x;
                    negFlag = 1;
            }
            length = PrintNum(buf, x, 10, negFlag, width, ladjust, padc, 0);
            OUTPUT(arg, buf, length);

            if (var_for != size-1) {
                    length = PrintChar(buf, ',', 1, 0);
                    OUTPUT(arg, buf, length);
            }

    }
}
```

å…¶å®ä¸Šé¢æ˜¯ä¸å¯¹çš„ã€‚å› ä¸ºæ²¡æœ‰è¾“å‡ºsizeï¼Œè¿™ä¹Ÿæ˜¯æˆ‘deäº†åŠå¤©ç©ºæ°”bugçš„åŸå› ä¹‹ä¸€ã€‚

ä¸ºå•¥ä¸ä¿®æ”¹å‘¢ï¼Ÿå› ä¸ºç­”æ¡ˆä¸èƒ½å…¨è¯´å‡ºæ¥ï¼Œä¸ç„¶é‚£æ ·å°±**æ²¡æ„æ€**äº†ï¼Œå‘µå‘µã€‚

æœ€ååˆ«å¿˜äº†è¾“å‡º`}`ä»¥åŠ`break`

```cpp
// print '}'
length = PrintChar(buf, '}', 1, 0);
OUTPUT(arg, buf, length);
break;
```

#### æµ‹è¯•

æµ‹è¯•æ¯”è¾ƒç®€å•ï¼Œåœ¨`init`ç›®å½•ä¸‹çš„`init.c`æ–‡ä»¶ä¸­ï¼Œå£°æ˜structï¼Œåˆå§‹åŒ–åè¾“å‡ºå°±è¡Œã€‚

```cpp
typedef struct {
        int a;
        char b;
        char c;
        int d;
} s1;

typedef struct {
        int size;
        int c[100];
} s2;


void mips_init()
{
        printf("init.c:\tmips_init() is called\n");

        s2 s = {3, {1,2,3}};
        printf("%$2T", &s);
        printf("\n");
```

### Extra

æ²¡åšï¼Œä½†æ˜¯å¯ä»¥å‘Šè¯‰åŒå­¦ä»¬ï¼Œ

1. è¦å†™æ±‡ç¼–ï¼Œå†™å‡½æ•°ï¼Œæ‰€ä»¥è¦ç†Ÿæ‚‰å¯„å­˜å™¨çš„ä½¿ç”¨çº¦å®š
2. è¦ä»cä»£ç å»è°ƒç”¨è‡ªå·±å†™çš„æ±‡ç¼–å‡½æ•°
3. æŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™å½“æ—¶è®¡ç»„çš„è‡ªå·±ï¼Œåº”è¯¥ä¸éš¾ï¼Œå¯ä»¥ï¼Œå¤§å®¶å·²ç»ä¸æ˜¯â€œä»å‰é‚£ä¸ªå°‘å¹´â€ğŸ˜•

å¯ä»¥çœ‹è¿™ä½å¤§ä½¬å†™çš„[åšå®¢](https://roife.github.io/2021/03/30/buaa-os-lab-lab1-2-printf/)ã€‚

## æ€»ç»“

å¾ˆå¤šäººéƒ½æŒ‚äº†ï¼Œæˆ‘è¿æ°”å¥½åœ¨åŠæ ¼çš„è¾¹ç¼˜å¾˜å¾Šï¼Œæ„Ÿè§‰å°±æ˜¯å”å±äº†ã€‚

è®²ä¸‹è‡ªå·±çš„åˆºæ¿€ä½“éªŒå§ï¼Œä»¥åŠä¸€äº›å‘ç‚¹ã€‚

### structçš„å®šä¹‰å’Œåˆå§‹åŒ–

å…¶å®æˆ‘æ˜¯ä¸ä¼š`struct`çš„å®šä¹‰çš„ï¼Œå½“åœºå­¦ä¹ äº†readelfæ–‡ä»¶å¤¹ä¸‹çš„types.hï¼Œå­¦ä¼šäº†å®šä¹‰ã€‚

ç„¶åå°±æ˜¯å¦‚ä½•ç»™ä¸€ä¸ª`struct`èµ‹å€¼ï¼Œç®€ç›´æ‡µé€¼äº†ï¼Œæˆ‘é¼“èµ·å‹‡æ°”ç›´æ¥é—®åŠ©æ•™å“¥å“¥`struct`æ€ä¹ˆåˆå§‹åŒ–ï¼Œæ„Ÿè°¢niceçš„åŠ©æ•™å“¥å“¥ã€‚

é™„ä¸€ä¸ªåˆå§‹åŒ–å®ä¾‹ï¼š

```cpp
typedef struct {
	int a;
	int b;
} s2;

s2 s = {1, 2};
```

é—®çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—åŠ©æ•™ä¸€å®šè¢«æˆ‘çš„æ— çŸ¥æŠ˜æœäº†ğŸ˜„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘å·²ç»è¢«è‡ªå·±çš„æ— çŸ¥æŠ˜æœäº†ã€‚

### structè·å–æˆå‘˜å˜é‡

æ—¶éš”ä¸€å¹´æœ‰ä½™ï¼Œæ—©å°±å¿˜è®°äº†é€šè¿‡`.`å’Œ`->`è·å–structä¸­æˆå‘˜å˜é‡çš„åŒºåˆ«äº†ã€‚

ç°åœ¨å‘Šè¯‰é‚£äº›å¿˜è®°äº†çš„åŒå­¦ï¼Œ`struct.var`å’Œ`struct_pointer->var`ã€‚

æ€ªä¸å¾—æˆ‘åœ¨`devc++`é‡Œé¢â€œæ¸©ä¹ â€`struct`çš„ä½¿ç”¨æ—¶ï¼Œè¦ç”¨`.`æ¥è·å–å…ƒç´ å€¼ï¼Œè€Œåœ¨`print.c`é‡Œï¼Œæˆ‘æœ€åç”¨`->`è·å–å…ƒç´ çš„å€¼ã€‚æˆ‘ä»¥ä¸ºäºŒè€…ç”¨æ³•æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯`struct_pointer.var`ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œæäº¤çš„æ—¶å€™è¯¯æ‰“è¯¯æ’å†™å¯¹äº†ã€‚

é™„ä¸Šä¸€ä¸ªæ ·ä¾‹ï¼š

```cpp
#include<stdio.h>

typedef struct {
	int size;
	int c[100];
} s2;

int main() {
	s2 s= {1, {1, 2, 3}};
	printf("%d\n", s.c[2]);
	s2* s_ptr = &s;
	printf("%d\n", s_ptr->size);
	return 0;
}
```

å­¦ä¹ structçš„åˆå§‹åŒ–ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ä¿®æ”¹init.cï¼Œæµ‹è¯•è‡ªå·±çš„ç¨‹åºï¼Œç”šè‡³çŒœä¸€çŒœè‡ªå·±çš„ç¨‹åºé”™åœ¨å“ªé‡Œï¼Œä¸è¿‡è°ƒè¯•æ˜¯ä¸å­˜åœ¨çš„ã€‚

ä¸‹mainè¿™ç§åˆå§‹åŒ–æ–¹å¼æ˜¯é”™è¯¯çš„ï¼š

```cpp
#include<stdio.h>

typedef struct {
	int size;
	int *c; // æ³¨æ„è¿™é‡Œï¼Œå£°æ˜æˆäº†ä¸€ä¸ªæŒ‡é’ˆè€Œä¸æ˜¯æ•°ç»„
} s2;

int main() {
	s2 s= {1, {1, 2, 3}}; // å°†æ— æ³•æ­£ç¡®æ¥å—å‚æ•°
	printf("%d\n", s.c[2]);
	s2* s_ptr = &s;
	printf("%d\n", s_ptr->size);
	return 0;
}
```

è¯¡å¼‚çš„æ˜¯ï¼Œè¿™æ ·å†™ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šè·‘ï¼Œä¼šè¾“å‡ºä¸€äº›å¥‡æ€ªçš„æ•°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨æœ¬åœ°æµ‹è¯•æ—¶çŠ¯ä¸‹çš„ç¬¬äºŒä¸ªé”™è¯¯ã€‚

### byebye

å¤§å®¶å¯ä»¥çœ‹ä¸‹17çº§å­¦é•¿çš„examï¼Œå½“æ—¶æ˜¯è®©å¤§å®¶ä¿®æ”¹printï¼Œæ”¯æŒæ•°ç»„çš„è¾“å‡ºã€‚
